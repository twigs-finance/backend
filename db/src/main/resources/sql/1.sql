CREATE TABLE IF NOT EXISTS budgets (id TEXT PRIMARY KEY, name TEXT NOT NULL, description TEXT DEFAULT NULL, currency_code TEXT DEFAULT NULL);
CREATE TABLE IF NOT EXISTS users (id TEXT PRIMARY KEY, username TEXT NOT NULL UNIQUE, password TEXT NOT NULL, email TEXT DEFAULT NULL UNIQUE);
CREATE TABLE IF NOT EXISTS categories (id          TEXT PRIMARY KEY, title       TEXT    NOT NULL, description TEXT DEFAULT NULL, amount      INTEGER NOT NULL, expense     BOOLEAN NOT NULL, archived    BOOLEAN NOT NULL, budget_id   TEXT    NOT NULL, CONSTRAINT fk_budgets FOREIGN KEY (budget_id) REFERENCES budgets (id) ON DELETE CASCADE);
CREATE TABLE IF NOT EXISTS sessions (id TEXT PRIMARY KEY, user_id TEXT NOT NULL, token TEXT NOT NULL, expiration TIMESTAMP NOT NULL);
CREATE TABLE IF NOT EXISTS user_permissions ( budget_id  TEXT NOT NULL, user_id    TEXT NOT NULL, permission TEXT NOT NULL, PRIMARY KEY (budget_id, user_id), CONSTRAINT fk_budgets FOREIGN KEY (budget_id) REFERENCES budgets (id) ON DELETE CASCADE, CONSTRAINT fk_users FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE);
CREATE TABLE IF NOT EXISTS transactions (id          TEXT PRIMARY KEY, title       TEXT    NOT NULL, description TEXT DEFAULT NULL, amount      INTEGER NOT NULL, date TIMESTAMP NOT NULL, expense     BOOLEAN NOT NULL, created_by  TEXT    NOT NULL, category_id TEXT    DEFAULT NULL, budget_id   TEXT    NOT NULL, CONSTRAINT fk_users FOREIGN KEY (created_by) REFERENCES users (id) ON DELETE CASCADE, CONSTRAINT fk_categories FOREIGN KEY (category_id) REFERENCES categories (id) ON DELETE CASCADE, CONSTRAINT fk_budgets FOREIGN KEY (budget_id) REFERENCES budgets (id) ON DELETE CASCADE);
CREATE TABLE IF NOT EXISTS twigs_metadata (version INTEGER NOT NULL, salt VARCHAR(16) NOT NULL);
